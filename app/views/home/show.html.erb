<div class="uk-grid">

  <div class="uk-width-5-6">
    <div id="map-canvas" style="height: 500px"></div>
  </div>

  <div class="uk-width-1-6">
    <div id="sidebar"></div>
  </div>
</div>




<script>
  var map;
  function initialize() {
    var myLatlng = new google.maps.LatLng(55.9532520,-3.1882670);
    var mapOptions = {
      zoom: 12,
      center: myLatlng,
      draggable: true
    }
    var locations = <%= raw Marker.produce_array %>
    var myLatlng;
    var map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);
    centerControlDiv = document.createElement('div');
    centerControl = new CenterControl(centerControlDiv, map)
    centerControlDiv.index = 1;
    map.controls[google.maps.ControlPosition.BOTTOM_LEFT].push(centerControlDiv);
    google.maps.event.addDomListener(window, 'resize', function() {
      myLatlng = new google.maps.LatLng(55.9532520,-3.1882670);
      map.setCenter(myLatlng)
      google.maps.event.trigger(map, 'resize');
    });
    var infowindow = new google.maps.InfoWindow;
    var marker, i;
    for (i = 0; i < locations.length; i++) {  
      marker = new google.maps.Marker({
           position: new google.maps.LatLng(locations[i][1], locations[i][2]),
           map: map
      });

    google.maps.event.addListener(marker, 'click', (function(marker, i) {
         return function() {
             var contentString = "<p>" + locations[i][0] + " is a " + locations[i][3] + " located at " + locations[i][7] + " " +locations[i][9]+ " " + locations[i][8] + ". It is open from " + locations[i][5] + " until " + locations[i][6] + ". </p>"
             infowindow.setContent(contentString);
             infowindow.open(map, marker);
         }
    })(marker, i));
  }  
  if(navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(function(position) {
      var pos = new google.maps.LatLng(position.coords.latitude,
                                       position.coords.longitude);
      var infowindow = new google.maps.InfoWindow({
        map: map,
        position: pos,
        content: 'You are here!'
      });

      map.setCenter(pos);
    }, function() {
      handleNoGeolocation(true);
    });

  } else {
    // Browser doesn't support Geolocation
    handleNoGeolocation(false);
  }
}

function CenterControl(controlDiv, map) {
  // Set CSS for the control border
  var controlUI = document.createElement('div');
  controlUI.style.backgroundColor = '#fff';
  controlUI.style.border = '2px solid #fff';
  controlUI.style.borderRadius = '3px';
  controlUI.style.boxShadow = '0 2px 6px rgba(0,0,0,.3)';
  controlUI.style.cursor = 'pointer';
  controlUI.style.marginBottom = '22px';
  controlUI.style.textAlign = 'center';
  controlUI.title = 'Click to recenter the map';
  controlDiv.appendChild(controlUI);

  // Set CSS for the control interior
  var controlText = document.createElement('div');
  controlText.style.color = 'rgb(25,25,25)';
  controlText.style.fontFamily = 'Roboto,Arial,sans-serif';
  controlText.style.fontSize = '16px';
  controlText.style.lineHeight = '38px';
  controlText.style.paddingLeft = '5px';
  controlText.style.paddingRight = '5px';
  controlText.innerHTML = 'Show Me Dog Venues';
  controlUI.appendChild(controlText);

  // Setup the click event listeners: simply set the map to
  // Edinburgh
  google.maps.event.addDomListener(controlUI, 'click', function() {
    myLatlng = new google.maps.LatLng(55.9532520,-3.1882670);
    map.setCenter(myLatlng)
  });
};
  
google.maps.event.addDomListener(window, 'load', initialize); 

</script>